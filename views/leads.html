<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BPO CRM - Leads</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
  <link href="/css/style.css" rel="stylesheet">
</head>
<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-md-2 sidebar p-0">
        <div class="d-flex flex-column p-3">
          <a href="/dashboard" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none">
            <span class="fs-4">CodePro Tech Jalna</span>
          </a>
          <hr>
          <ul class="nav nav-pills flex-column mb-auto">
            <li class="nav-item">
              <a href="/dashboard" class="nav-link text-white">
                <i class="bi bi-speedometer2 me-2"></i>Dashboard
              </a>
            </li>
            <li>
              <a href="/customers" class="nav-link text-white">
                <i class="bi bi-people me-2"></i>Customers
              </a>
            </li>
            <li>
              <a href="/leads" class="nav-link active">
                <i class="bi bi-person-plus me-2"></i>Leads
              </a>
            </li>
            <li>
              <a href="/tasks" class="nav-link text-white">
                <i class="bi bi-list-check me-2"></i>Tasks
              </a>
            </li>
            <li>
              <a href="/reports" class="nav-link text-white">
                <i class="bi bi-bar-chart me-2"></i>Reports
              </a>
            </li>
          </ul>
          <hr>
          <div class="dropdown">
            <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
              <img src="https://via.placeholder.com/32" alt="User" width="32" height="32" class="rounded-circle me-2">
              <strong>Admin</strong>
            </a>
            <ul class="dropdown-menu dropdown-menu-dark text-small shadow" aria-labelledby="dropdownUser1">
              <li><a class="dropdown-item" href="#">Settings</a></li>
              <li><a class="dropdown-item" href="#">Profile</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="/">Sign out</a></li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Main content -->
      <div class="col-md-10 ms-sm-auto main-content">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
          <h1 class="h2">Leads</h1>
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addLeadModal">
            <i class="bi bi-plus-circle me-1"></i> Add Lead
          </button>
        </div>

        <!-- Filters and Search -->
        <div class="row mb-3">
          <div class="col-md-6">
            <div class="input-group">
              <input type="text" class="form-control" id="searchLead" placeholder="Search leads...">
              <button class="btn btn-outline-secondary" type="button">
                <i class="bi bi-search"></i>
              </button>
            </div>
          </div>
          <div class="col-md-3">
            <select class="form-select" id="statusFilter">
              <option value="">All Statuses</option>
              <option value="New">New</option>
              <option value="Contacted">Contacted</option>
              <option value="Qualified">Qualified</option>
              <option value="Proposal">Proposal</option>
              <option value="Closed">Closed</option>
              <option value="Lost">Lost</option>
            </select>
          </div>
          <div class="col-md-3">
            <select class="form-select" id="sourceFilter">
              <option value="">All Sources</option>
              <option value="Website">Website</option>
              <option value="Referral">Referral</option>
              <option value="Cold Call">Cold Call</option>
              <option value="Social Media">Social Media</option>
              <option value="Email Campaign">Email Campaign</option>
            </select>
          </div>
        </div>

        <!-- Leads Table -->
        <div class="card">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Company</th>
                    <th>Contact</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Status</th>
                    <th>Source</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="leadsTable">
                  <!-- Leads will be loaded here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Lead Modal -->
  <div class="modal fade" id="addLeadModal" tabindex="-1" aria-labelledby="addLeadModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addLeadModalLabel">Add New Lead</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="addLeadForm">
            <div class="mb-3">
              <label for="leadCompany" class="form-label">Company Name</label>
              <input type="text" class="form-control" id="leadCompany" required>
            </div>
            <div class="mb-3">
              <label for="leadContact" class="form-label">Contact Person</label>
              <input type="text" class="form-control" id="leadContact" required>
            </div>
            <div class="mb-3">
              <label for="leadEmail" class="form-label">Email</label>
              <input type="email" class="form-control" id="leadEmail" required>
            </div>
            <div class="mb-3">
              <label for="leadPhone" class="form-label">Phone</label>
              <input type="text" class="form-control" id="leadPhone" required>
            </div>
            <div class="mb-3">
              <label for="leadStatus" class="form-label">Status</label>
              <select class="form-select" id="leadStatus">
                <option value="New" selected>New</option>
                <option value="Contacted">Contacted</option>
                <option value="Qualified">Qualified</option>
                <option value="Proposal">Proposal</option>
                <option value="Closed">Closed</option>
                <option value="Lost">Lost</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="leadSource" class="form-label">Source</label>
              <select class="form-select" id="leadSource">
                <option value="Website" selected>Website</option>
                <option value="Referral">Referral</option>
                <option value="Cold Call">Cold Call</option>
                <option value="Social Media">Social Media</option>
                <option value="Email Campaign">Email Campaign</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="leadNotes" class="form-label">Notes</label>
              <textarea class="form-control" id="leadNotes" rows="3"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="saveLeadBtn">Save Lead</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Lead Modal -->
  <div class="modal fade" id="editLeadModal" tabindex="-1" aria-labelledby="editLeadModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editLeadModalLabel">Edit Lead</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="editLeadForm">
            <input type="hidden" id="editLeadId">
            <div class="mb-3">
              <label for="editLeadCompany" class="form-label">Company Name</label>
              <input type="text" class="form-control" id="editLeadCompany" required>
            </div>
            <div class="mb-3">
              <label for="editLeadContact" class="form-label">Contact Person</label>
              <input type="text" class="form-control" id="editLeadContact" required>
            </div>
            <div class="mb-3">
              <label for="editLeadEmail" class="form-label">Email</label>
              <input type="email" class="form-control" id="editLeadEmail" required>
            </div>
            <div class="mb-3">
              <label for="editLeadPhone" class="form-label">Phone</label>
              <input type="text" class="form-control" id="editLeadPhone" required>
            </div>
            <div class="mb-3">
              <label for="editLeadStatus" class="form-label">Status</label>
              <select class="form-select" id="editLeadStatus">
                <option value="New">New</option>
                <option value="Contacted">Contacted</option>
                <option value="Qualified">Qualified</option>
                <option value="Proposal">Proposal</option>
                <option value="Closed">Closed</option>
                <option value="Lost">Lost</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="editLeadSource" class="form-label">Source</label>
              <select class="form-select" id="editLeadSource">
                <option value="Website">Website</option>
                <option value="Referral">Referral</option>
                <option value="Cold Call">Cold Call</option>
                <option value="Social Media">Social Media</option>
                <option value="Email Campaign">Email Campaign</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="editLeadNotes" class="form-label">Notes</label>
              <textarea class="form-control" id="editLeadNotes" rows="3"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="updateLeadBtn">Update Lead</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Lead Details Modal with Communication Tools -->
  <div class="modal fade" id="leadDetailsModal" tabindex="-1" aria-labelledby="leadDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="leadDetailsModalLabel">Lead Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6">
              <h6>Company Info</h6>
              <table class="table">
                <tr>
                  <th>Company:</th>
                  <td id="detailLeadCompany"></td>
                </tr>
                <tr>
                  <th>Contact:</th>
                  <td id="detailLeadContact"></td>
                </tr>
                <tr>
                  <th>Email:</th>
                  <td id="detailLeadEmail"></td>
                </tr>
                <tr>
                  <th>Phone:</th>
                  <td id="detailLeadPhone"></td>
                </tr>
                <tr>
                  <th>Status:</th>
                  <td id="detailLeadStatus"></td>
                </tr>
                <tr>
                  <th>Source:</th>
                  <td id="detailLeadSource"></td>
                </tr>
              </table>
            </div>
            <div class="col-md-6">
              <h6>Actions</h6>
              <div class="d-grid gap-2">
                <button class="btn btn-outline-primary" id="sendEmailBtn">
                  <i class="bi bi-envelope me-2"></i>Send Email
                </button>
                <button class="btn btn-outline-success" id="logCallBtn">
                  <i class="bi bi-telephone me-2"></i>Log Call
                </button>
                <button class="btn btn-outline-info" id="scheduleTaskBtn">
                  <i class="bi bi-calendar me-2"></i>Schedule Task
                </button>
                <button class="btn btn-outline-warning" id="convertToCustomerBtn">
                  <i class="bi bi-arrow-right me-2"></i>Convert to Customer
                </button>
              </div>
            </div>
          </div>
          <div class="row mt-4">
            <div class="col-12">
              <h6>Notes</h6>
              <p id="detailLeadNotes"></p>
            </div>
          </div>
          <!-- Communication History -->
          <div class="row mt-4">
            <div class="col-12">
              <h6>Communication History</h6>
              <ul class="list-group" id="communicationHistory">
                <!-- History will be loaded here -->
              </ul>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Send Email Modal -->
  <div class="modal fade" id="sendEmailModal" tabindex="-1" aria-labelledby="sendEmailModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="sendEmailModalLabel">Send Email</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="emailForm">
            <input type="hidden" id="emailLeadId">
            <div class="mb-3">
              <label for="emailTo" class="form-label">To</label>
              <input type="email" class="form-control" id="emailTo" readonly>
            </div>
            <div class="mb-3">
              <label for="emailSubject" class="form-label">Subject</label>
              <input type="text" class="form-control" id="emailSubject" required>
            </div>
            <div class="mb-3">
              <label for="emailBody" class="form-label">Message</label>
              <textarea class="form-control" id="emailBody" rows="6" required></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="sendEmailSubmitBtn">Send Email</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Log Call Modal -->
  <div class="modal fade" id="logCallModal" tabindex="-1" aria-labelledby="logCallModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="logCallModalLabel">Log Call</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="callForm">
            <input type="hidden" id="callLeadId">
            <div class="mb-3">
              <label for="callContact" class="form-label">Contact</label>
              <input type="text" class="form-control" id="callContact" readonly>
            </div>
            <div class="mb-3">
              <label for="callPhone" class="form-label">Phone</label>
              <input type="text" class="form-control" id="callPhone" readonly>
            </div>
            <div class="mb-3">
              <label for="callDate" class="form-label">Date & Time</label>
              <input type="datetime-local" class="form-control" id="callDate" required>
            </div>
            <div class="mb-3">
              <label for="callDuration" class="form-label">Duration (minutes)</label>
              <input type="number" class="form-control" id="callDuration" min="1" value="15">
            </div>
            <div class="mb-3">
              <label for="callOutcome" class="form-label">Outcome</label>
              <select class="form-select" id="callOutcome" required>
                <option value="Left Message">Left Message</option>
                <option value="Spoke to Contact">Spoke to Contact</option>
                <option value="No Answer">No Answer</option>
                <option value="Busy/Call Back">Busy/Call Back</option>
                <option value="Wrong Number">Wrong Number</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="callNotes" class="form-label">Notes</label>
              <textarea class="form-control" id="callNotes" rows="3"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="logCallSubmitBtn">Log Call</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Load leads
    function loadLeads() {
      fetch('/api/leads')
        .then(response => response.json())
        .then(data => {
          const leadsTable = document.getElementById('leadsTable');
          leadsTable.innerHTML = '';
          
          data.forEach(lead => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${lead.company}</td>
              <td>${lead.contact}</td>
              <td>${lead.email}</td>
              <td>${lead.phone}</td>
              <td><span class="status-badge status-${lead.status.toLowerCase()}">${lead.status}</span></td>
              <td>${lead.source}</td>
              <td>
                <button class="btn btn-sm btn-outline-info view-lead" data-id="${lead.id}">
                  <i class="bi bi-eye"></i>
                </button>
                <button class="btn btn-sm btn-outline-primary edit-lead" data-id="${lead.id}">
                  <i class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger delete-lead" data-id="${lead.id}">
                  <i class="bi bi-trash"></i>
                </button>
              </td>
            `;
            leadsTable.appendChild(row);
          });
          
          // Add event listeners for view buttons
          document.querySelectorAll('.view-lead').forEach(button => {
            button.addEventListener('click', function() {
              const leadId = this.getAttribute('data-id');
              viewLeadDetails(leadId);
            });
          });
          
          // Add event listeners for edit buttons
          document.querySelectorAll('.edit-lead').forEach(button => {
            button.addEventListener('click', function() {
              const leadId = this.getAttribute('data-id');
              editLead(leadId);
            });
          });
          
          // Add event listeners for delete buttons
          document.querySelectorAll('.delete-lead').forEach(button => {
            button.addEventListener('click', function() {
              const leadId = this.getAttribute('data-id');
              deleteLead(leadId);
            });
          });
        });
    }
    
    // View lead details
    function viewLeadDetails(id) {
      fetch(`/api/leads/${id}`)
        .then(response => response.json())
        .then(lead => {
          document.getElementById('detailLeadCompany').textContent = lead.company;
          document.getElementById('detailLeadContact').textContent = lead.contact;
          document.getElementById('detailLeadEmail').textContent = lead.email;
          document.getElementById('detailLeadPhone').textContent = lead.phone;
          document.getElementById('detailLeadStatus').textContent = lead.status;
          document.getElementById('detailLeadSource').textContent = lead.source;
          document.getElementById('detailLeadNotes').textContent = lead.notes || 'No notes available';
          
          // Store lead ID for communication actions
          document.getElementById('sendEmailBtn').setAttribute('data-id', lead.id);
          document.getElementById('logCallBtn').setAttribute('data-id', lead.id);
          document.getElementById('scheduleTaskBtn').setAttribute('data-id', lead.id);
          document.getElementById('convertToCustomerBtn').setAttribute('data-id', lead.id);
          
          // Show the modal
          const detailsModal = new bootstrap.Modal(document.getElementById('leadDetailsModal'));
          detailsModal.show();
          
          // Load communication history (mock data for now)
          loadCommunicationHistory(id);
        });
    }
    
    // Load communication history
    function loadCommunicationHistory(leadId) {
      // Mock data for communication history
      const history = [
        { type: 'Email', date: '2023-03-15 14:30', description: 'Initial contact email sent', status: 'Sent' },
        { type: 'Call', date: '2023-03-16 10:15', description: 'Follow-up call to discuss services', status: 'Completed' },
        { type: 'Email', date: '2023-03-17 09:45', description: 'Sent service proposal', status: 'Sent' }
      ];
      
      const historyList = document.getElementById('communicationHistory');
      historyList.innerHTML = '';
      
      if (history.length === 0) {
        historyList.innerHTML = '<li class="list-group-item">No communication history available</li>';
        return;
      }
      
      history.forEach(item => {
        const listItem = document.createElement('li');
        listItem.className = 'list-group-item';
        
        let icon = '';
        if (item.type === 'Email') {
          icon = '<i class="bi bi-envelope me-2 text-primary"></i>';
        } else if (item.type === 'Call') {
          icon = '<i class="bi bi-telephone me-2 text-success"></i>';
        } else {
          icon = '<i class="bi bi-calendar me-2 text-info"></i>';
        }
        
        listItem.innerHTML = `
          ${icon}<strong>${item.type}</strong> - ${item.date}
          <p class="mb-0 ms-4">${item.description}</p>
        `;
        
        historyList.appendChild(listItem);
      });
    }
    
    // Edit lead
    function editLead(id) {
      fetch(`/api/leads/${id}`)
        .then(response => response.json())
        .then(lead => {
          document.getElementById('editLeadId').value = lead.id;
          document.getElementById('editLeadCompany').value = lead.company;
          document.getElementById('editLeadContact').value = lead.contact;
          document.getElementById('editLeadEmail').value = lead.email;
          document.getElementById('editLeadPhone').value = lead.phone;
          document.getElementById('editLeadStatus').value = lead.status;
          document.getElementById('editLeadSource').value = lead.source;
          document.getElementById('editLeadNotes').value = lead.notes || '';
          
          // Show the modal
          const editModal = new bootstrap.Modal(document.getElementById('editLeadModal'));
          editModal.show();
        });
    }
    
    // Delete lead
    function deleteLead(id) {
      if (confirm('Are you sure you want to delete this lead?')) {
        fetch(`/api/leads/${id}`, {
          method: 'DELETE'
        })
          .then(response => response.json())
          .then(() => {
            loadLeads();
          });
      }
    }
    
    // Send email to lead
    function sendEmail(leadId) {
      fetch(`/api/leads/${leadId}`)
        .then(response => response.json())
        .then(lead => {
          document.getElementById('emailLeadId').value = lead.id;
          document.getElementById('emailTo').value = lead.email;
          
          // Show the modal
          const emailModal = new bootstrap.Modal(document.getElementById('sendEmailModal'));
          emailModal.show();
        });
    }
    
    // Log call to lead
    function logCall(leadId) {
      fetch(`/api/leads/${leadId}`)
        .then(response => response.json())
        .then(lead => {
          document.getElementById('callLeadId').value = lead.id;
          document.getElementById('callContact').value = lead.contact;
          document.getElementById('callPhone').value = lead.phone;
          
          // Set current date and time
          const now = new Date();
          now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
          document.getElementById('callDate').value = now.toISOString().slice(0, 16);
          
          // Show the modal
          const callModal = new bootstrap.Modal(document.getElementById('logCallModal'));
          callModal.show();
        });
    }
    
    // Document ready
    document.addEventListener('DOMContentLoaded', function() {
      // Load leads on page load
      loadLeads();
      
      // Add new lead
      document.getElementById('saveLeadBtn').addEventListener('click', function() {
        const leadData = {
          company: document.getElementById('leadCompany').value,
          contact: document.getElementById('leadContact').value,
          email: document.getElementById('leadEmail').value,
          phone: document.getElementById('leadPhone').value,
          status: document.getElementById('leadStatus').value,
          source: document.getElementById('leadSource').value,
          notes: document.getElementById('leadNotes').value
        };
        
        fetch('/api/leads', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(leadData)
        })
          .then(response => response.json())
          .then(() => {
            // Close the modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addLeadModal'));
            modal.hide();
            
            // Clear the form
            document.getElementById('addLeadForm').reset();
            
            // Reload leads
            loadLeads();
          });
      });
      
      // Update lead
      document.getElementById('updateLeadBtn').addEventListener('click', function() {
        const leadId = document.getElementById('editLeadId').value;
        const leadData = {
          company: document.getElementById('editLeadCompany').value,
          contact: document.getElementById('editLeadContact').value,
          email: document.getElementById('editLeadEmail').value,
          phone: document.getElementById('editLeadPhone').value,
          status: document.getElementById('editLeadStatus').value,
          source: document.getElementById('editLeadSource').value,
          notes: document.getElementById('editLeadNotes').value
        };
        
        fetch(`/api/leads/${leadId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(leadData)
        })
          .then(response => response.json())
          .then(() => {
            // Close the modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('editLeadModal'));
            modal.hide();
            
            // Reload leads
            loadLeads();
          });
      });
      
      // Send Email Button Event
      document.getElementById('sendEmailBtn').addEventListener('click', function() {
        const leadId = this.getAttribute('data-id');
        sendEmail(leadId);
      });
      
      // Log Call Button Event
      document.getElementById('logCallBtn').addEventListener('click', function() {
        const leadId = this.getAttribute('data-id');
        logCall(leadId);
      });
      
      // Send Email Submit
      document.getElementById('sendEmailSubmitBtn').addEventListener('click', function() {
        const emailData = {
          leadId: document.getElementById('emailLeadId').value,
          to: document.getElementById('emailTo').value,
          subject: document.getElementById('emailSubject').value,
          body: document.getElementById('emailBody').value
        };
        
        // For demo purposes, we just log the email data and close the modal
        console.log('Email Sent:', emailData);
        alert('Email sent successfully!');
        
        // Close the email modal
        const emailModal = bootstrap.Modal.getInstance(document.getElementById('sendEmailModal'));
        emailModal.hide();
        
        // Close the lead details modal
        const detailsModal = bootstrap.Modal.getInstance(document.getElementById('leadDetailsModal'));
        detailsModal.hide();
        
        // Reload leads
        loadLeads();
      });
      
      // Log Call Submit
      document.getElementById('logCallSubmitBtn').addEventListener('click', function() {
        const callData = {
          leadId: document.getElementById('callLeadId').value,
          contact: document.getElementById('callContact').value,
          phone: document.getElementById('callPhone').value,
          date: document.getElementById('callDate').value,
          duration: document.getElementById('callDuration').value,
          outcome: document.getElementById('callOutcome').value,
          notes: document.getElementById('callNotes').value
        };
        
        // For demo purposes, we just log the call data and close the modal
        console.log('Call Logged:', callData);
        alert('Call logged successfully!');
        
        // Close the call modal
        const callModal = bootstrap.Modal.getInstance(document.getElementById('logCallModal'));
        callModal.hide();
        
        // Close the lead details modal
        const detailsModal = bootstrap.Modal.getInstance(document.getElementById('leadDetailsModal'));
        detailsModal.hide();
        
        // Reload leads
        loadLeads();
      });
    });
  </script>
</body>
</html>